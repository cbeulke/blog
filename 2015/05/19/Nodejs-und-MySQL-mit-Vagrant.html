<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Node.js und MySQL mit Vagrant</title>
    <meta name="description" content="" />
    <link href="//fonts.googleapis.com/css?family=Noto+Sans:300,400,700" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Noto+Serif:400,700,400italic" rel="stylesheet" type="text/css">
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link href="//cbeulke.github.io/blog/themes/Saga/assets/css/style.css?v=1.0.0" rel="stylesheet" type="text/css">
    <link href="//cbeulke.github.io/blog/themes/Saga/assets/css/animate.min.css?v=1.0.0" rel="stylesheet" type="text/css">
    <link href="//cbeulke.github.io/blog/themes/Saga/favicon.ico" rel="shortcut icon">
    <link rel="canonical" href="https://cbeulke.github.io/blog/2015/05/19/Nodejs-und-MySQL-mit-Vagrant.html" />
    
    <meta property="og:site_name" content="Beulke Blog" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Node.js und MySQL mit Vagrant" />
    <meta property="og:description" content="Für die Entwicklung von Node.js-Applikationen habe ich mir eine Laufzeitumgebung mit Vagrant eingerichtet, um nicht ständig mein System beschmutzen zu müssen. Die Vorteile liegen klar auf der Hand. Eine klar abgegrenzte virtuelle Maschine sorgt für die Bereitstellung meiner Syst..." />
    <meta property="og:url" content="https://cbeulke.github.io/blog/2015/05/19/Nodejs-und-MySQL-mit-Vagrant.html" />
    <meta property="article:published_time" content="2015-05-18T22:00:00.000Z" />
    <meta property="article:modified_time" content="2016-10-17T09:36:02.785Z" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Node.js und MySQL mit Vagrant" />
    <meta name="twitter:description" content="Für die Entwicklung von Node.js-Applikationen habe ich mir eine Laufzeitumgebung mit Vagrant eingerichtet, um nicht ständig mein System beschmutzen zu müssen. Die Vorteile liegen klar auf der Hand. Eine klar abgegrenzte virtuelle Maschine sorgt für die Bereitstellung meiner Syst..." />
    <meta name="twitter:url" content="https://cbeulke.github.io/blog/2015/05/19/Nodejs-und-MySQL-mit-Vagrant.html" />
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "Beulke Blog",
    "author": {
        "@type": "Person",
        "name": "Christian Beulke",
        "image": "https://avatars.githubusercontent.com/u/344617?v=3",
        "url": "undefined/author/undefined",
        "sameAs": "www.beulke.net"
    },
    "headline": "Node.js und MySQL mit Vagrant",
    "url": "https://cbeulke.github.io/blog/2015/05/19/Nodejs-und-MySQL-mit-Vagrant.html",
    "datePublished": "2015-05-18T22:00:00.000Z",
    "dateModified": "2016-10-17T09:36:02.785Z",
    "description": "Für die Entwicklung von Node.js-Applikationen habe ich mir eine Laufzeitumgebung mit Vagrant eingerichtet, um nicht ständig mein System beschmutzen zu müssen. Die Vorteile liegen klar auf der Hand. Eine klar abgegrenzte virtuelle Maschine sorgt für die Bereitstellung meiner Syst..."
}
    </script>

    <meta name="generator" content="Ghost ?" />
    <link rel="alternate" type="application/rss+xml" title="Beulke Blog" href="https://cbeulke.github.io/blog/rss" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/default.min.css">
</head>
<body class="post-template">
    <header id="header" class="animated fadeIn">
    <div class="header-background">
    <section class="blog-content">
        <a id="site-url" class="blog-title" href="https://cbeulke.github.io/blog">Beulke Blog</a>
        <span class="blog-description"></span>
        <nav class="links fadeIn animated">
            <ul>
                <!-- <li class="rss"><a title="RSS Feed" href="/rss/"><i class="fa fa-fw fa-rss-square"></i></a></li> -->
        
            </ul>
        </nav>
    </section>
    <section class="header-content">
        <h1 class="post-title animated fadeInUp">Node.js und MySQL mit Vagrant</h1>
        <span class="post-data"><span class="date animated fadeInUp"><i class="fa fa-clock-o"></i> <time class="timesince date" data-timesince="1431986400" datetime="2015-05-19T00:00" title="19 May 2015">2015-05-19 00:00:00<ago class="ago"></time></span>
            
            <span class="author animated fadeInUp"><i class="fa fa-user"></i> <a href="">Christian Beulke</a></span></span>
    </section>
    </div>
</header>
<main id="main" class="content">
    <article itemtype="http://schema.org/BlogPosting" class="animated fadeIn content post post">
        <section class="post-content">
            <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Für die Entwicklung von <strong>Node.js</strong>-Applikationen habe ich mir eine Laufzeitumgebung mit <strong>Vagrant</strong> eingerichtet, um nicht ständig mein System beschmutzen zu müssen. Die Vorteile liegen klar auf der Hand. Eine klar abgegrenzte virtuelle Maschine sorgt für die Bereitstellung meiner Systemumgebung, während ich mit meinen lokalen Werkzeugen bequem althergebracht an meinem Code schrauben kann.</p>
</div>
<div class="paragraph">
<p>Die Einrichtung hat mich einige Mühe und die Hilfe verschiedener Quellen gekostet, letztendlich bin ich jedoch am Ziel angelangt, zumindest eine erste Basis für weitere Entwicklungen zu legen.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_der_vorrausgesetzten_tools">Installation der vorrausgesetzten Tools</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Folgende Tools werden benötigt und sollten vor Beginn installiert werden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Vagrant</strong></p>
</li>
<li>
<p><strong>Node.js</strong></p>
</li>
<li>
<p><strong>npm</strong></p>
</li>
<li>
<p>Texteditor</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_initialisierung_des_strong_vagrant_strong_projekts">Initialisierung des <strong>Vagrant</strong>-Projekts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Zuerst lege ich ein Projektverzeichnis an und initialisiere dort mein <code><code>Vagrantfile</code></code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">mkdir project
cd project
vagrant init</code></pre>
</div>
</div>
<div class="paragraph">
<p>In der <code><code>Vagrantfile</code></code> sind ein paar grundlegende Dinge vorhanden, diese ersetze ich jedoch durch folgende Einträge.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">Vagrant.configure("2") do |config|
  config.vm.box = "hashicorp/precise64"
  config.vm.provision :shell, path: "bootstrap.sh"
  config.vm.network :forwarded_port, guest: 3000, host: 3000
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wie man sieht, wähle ich als Grundlage Ubuntu aus, auf dem ich ein Vorbereitunsscript ausführe (dazu mehr im nächsten Schritt). Letztendlich sehe ich künftig Port 3000 für die Kommunikation mit meiner Applikation vor.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zusammenstellen_der_bootstrap_sh">Zusammenstellen der bootstrap.sh</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In meiner virtuellen Maschine möchte ich folgende Komponenten nutzen.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Node.js</strong></p>
</li>
<li>
<p><strong>npm</strong></p>
</li>
<li>
<p><strong>GruntJS</strong></p>
</li>
<li>
<p>Einen <strong>MySQL</strong>-Server</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Bei der Intialisierung der virtuellen Maschine führt <strong>Vagrant</strong> die von mir anzulegende <code><code>bootstrap.sh</code></code> aus. Als erstes lege ich die Datei an und schreibe Grundlegendes hinein.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">#!/usr/bin/env bash
apt-get update</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="__strong_node_js_strong_strong_npm_strong_und_strong_gruntjs_strong"><strong>Node.js</strong>, <strong>npm</strong> und <strong>GruntJS</strong></h3>
<div class="paragraph">
<p>Als nächstes wird <strong>Node.js</strong> installiert. Hierfür wird <code><code>curl</code></code> benötigt. <strong>npm</strong> wird zusammen mit <strong>Node.js</strong> installiert.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">apt-get install -y curl
curl -sL https://deb.nodesource.com/setup_6.x | bash -
apt-get install -y nodejs</code></pre>
</div>
</div>
<div class="paragraph">
<p>Da ich meine Projekte später mit <strong>GruntJS</strong> bauen möchte, installiere ich auch dieses gleich noch global.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">npm install -g grunt-cli</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__strong_mysql_strong_server"><strong>MySQL</strong>-Server</h3>
<div class="paragraph">
<p>Als nächstes findet die Installation des <strong>MySQL</strong>-Servers statt. Diese erfordert einen kleinen Trick, da im Zuge der Installation normalerweise die Eingabe des root-Passworts gefordert wird. Ich will jedoch den Vorgang "headless", also ohne weitere Interaktion mit dem Benutzer vonstatten gehen lassen. Darum konfiguriere ich mein System zuerst mit den passenden Eingaben vor. Diesen Kniff habe ich <a href="http://www.thisprogrammingthing.com/2013/getting-started-with-vagrant/">hier</a> gefunden.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">debconf-set-selections &lt;&lt;&lt; 'mysql-server-5.5 mysql-server/root_password password rootpass'

debconf-set-selections &lt;&lt;&lt; 'mysql-server-5.5 mysql-server/root_password_again password rootpass'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Somit wird im nächsten Schritt der <strong>MySQL</strong>-Server mit dem Benutzer <code><code>root</code></code> und dem Passwort <code><code>rootpass</code></code> installiert.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">apt-get install -y mysql-server-5.5</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_einrichten_der_datenbank">Einrichten der Datenbank</h3>
<div class="paragraph">
<p>Zuletzt initialisiere ich den Datenbankserver mit einem Benutzer für meine Applikation sowie einer dafür vorgesehenen Datenbank.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">if [ ! -f /var/log/databasesetup ]; then
	echo "CREATE USER 'nodeuser'@'localhost' IDENTIFIED BY 'nodepass'" | mysql -uroot -prootpass
	echo "CREATE DATABASE node" | mysql -uroot -prootpass
	echo "GRANT ALL ON node.* TO 'nodeuser'@'localhost'" | mysql -uroot -prootpass
	echo "flush privileges" | mysql -uroot -prootpass

	touch /var/log/databasesetup

	if [ -f /vagrant/data/init.sql ]; then
		mysql -uroot -prootpass node &lt; /vagrant/data/init.sql
	fi
fi</code></pre>
</div>
</div>
<div class="paragraph">
<p>Als Bonus habe ich die Möglichkeit, in meinem Projektverzeichnis im Unterordner <code><code>/data</code></code> eine Datei namens <code><code>init.sql</code></code> abzulegen, über die ich meine Datenbank letztendlich mit Tabellen und Datensätzen vorkonfigurieren kann.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hochfahren_und_testen">Hochfahren und Testen</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Meine virtuelle Maschine starte ich nun mit dem Befehl <code><code>vagrant up</code></code>. Wenn ich mich nun per <code><code>vagrant ssh</code></code> auf die Maschine aufschalte, kann ich dort Aktionen auf meiner Datenbank ausführen.</p>
</div>
<div class="paragraph">
<p>Das Verzeichnis <code><code>/vagrant</code></code> beinhaltet alle Dateien meines Arbeitsverzeichnisses, so dass ich meine Applikation nun normal auf dem Hostsystem entwickeln und in meiner virtuellen Maschine hochfahren und testen kann.</p>
</div>
<div class="paragraph">
<p>Welche Vorteile habe ich nun durch diese Umgebung erhalten?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Keine Installation von Node.js in meinem eigentlichen Betriebssystem erforderlich (lediglich npm ist für die Installation von Abhängigkeiten direkt vom Hostsystem aus nötig)</p>
</li>
<li>
<p>Keine Installation eines MySQL-Servers erforderlich</p>
</li>
<li>
<p>Zurücksetzen der Laufzeitumgebung ist jederzeit mit <code><code>vagrant destroy</code></code> und <code><code>vagrant up</code></code> möglich</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Die komplette <code><code>bootstrap.sh</code></code> findest Du <a href="https://gist.github.com/cbeulke/3a3611d6e06a457e081332e6ff0c4a56">hier</a>.</p>
</div>
</div>
</div>
        </section>

    </article>

</main>
    <footer class="animated fadeIn" id="footer">
        <section class="colophon">
          <section class="copyright">Copyright &copy; <span itemprop="copyrightHolder">Beulke Blog</span>. <span rel="license">All Rights Reserved</span>.</section>
          <section class="poweredby">Published with <a class="icon-ghost" href="http://hubpress.io">HubPress</a></section>
        </section>
        <section class="bottom">
          <section class="attribution">
            <a href="http://github.com/Reedyn/Saga">Built with <i class="fa fa-heart"></i> and Free and Open-Source Software</a>.
          </section>
        </section>
    </footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js?v="></script> 
      <script type="text/javascript">
        jQuery( document ).ready(function() {
          // change date with ago
          jQuery('ago.ago').each(function(){
            var element = jQuery(this).parent();
            element.html( moment(element.text()).fromNow());
          });
        });

        hljs.initHighlightingOnLoad();      
      </script>
    <script src="//cbeulke.github.io/blog/themes/Saga/assets/js/scripts.js?v=1.0.0"></script>
    
</body>
</html>
